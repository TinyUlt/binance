<!DOCTYPE html>
<html>
<body>
<script type="text/javascript" src="js/loader.js"></script>
<script  type="text/javascript" src="js/jquery.min.js"></script>


<script type="text/javascript">

    let pricelist = null;
    let symbol = null;
    function printPriceList() {

        let priceTable = document.getElementById('priceTable');
        while(priceTable.hasChildNodes()){
            priceTable.removeChild(priceTable.lastChild)
        }

        for(let i = 0; i < pricelist.length; i++){
            let tr = document.createElement("tr");
            priceTable.appendChild(tr);
            let tdPrice = document.createElement("td");
            let tdDelete = document.createElement("td");
            priceTable.appendChild(tdPrice);
            priceTable.appendChild(tdDelete);


            let label=document.createElement("label");
            label.textContent = pricelist[i];

            let button=document.createElement("button");
            button.textContent='delete';
            button.onclick = function () {
                let price = pricelist[i];

                var tina = pricelist.filter((p) => {
                    return p == price;
                });
                var index = pricelist.indexOf(tina[0]);
                index > -1 && pricelist.splice(index, 1);

                console.log(pricelist);
                pushPriceList();
            };

            tdPrice.appendChild(label);
            tdDelete.appendChild(button);
            document.body.appendChild(priceTable);
        }
    }
    function createSymbol(s){
        _get = `/d_createSymbol?symbol=${s}`;
        console.log(_get);
        $.post(_get,function(cd,status){

            getEnableSymbols();

        });
    }
    function deleteSymbol(s){
        _get = `/d_deleteSymbol?symbol=${s}`;
        console.log(_get);
        $.post(_get,function(cd,status){

            getEnableSymbols();

        });
    }
    function getPriceList() {
        _get = `/d_getPriceList?symbol=${symbol}`;
        console.log(_get);
        $.post(_get,function(cd,status){

                pricelist = JSON.parse(cd);

            console.log(pricelist);

            printPriceList();

        });

    }
    function pushPriceList() {
        _get = `/d_pushPriceList?symbol=${symbol}&priceList=${JSON.stringify(pricelist)}`;
        console.log(_get);
        $.post(_get,function(cd,status){

            pricelist = JSON.parse(cd);

            console.log(pricelist);

            printPriceList();

        });

    }
    function getPrice(){
        _get = `/d_getPrice?symbol=${symbol}`;

        $.post(_get,function(cd,status){

            console.log(cd);
            let nowPrice = JSON.parse(cd);
            document.getElementById('nowPrice').textContent=`Now Price:${nowPrice[symbol]}`;

        });
    }

    function getEnableSymbols(){
        _get = `/d_getEnableSymbols`;

        $.post(_get,function(cd,status){

            console.log(cd);
            let symbols = JSON.parse(cd);

            let symbolSelect = document.getElementById('symbol');
            while(symbolSelect.hasChildNodes()){
                symbolSelect.removeChild(symbolSelect.lastChild)
            }

           for(let i=0;i<symbols.length;i++){
               let option = document.createElement("option");
               option.value = symbols[i];
               option.textContent = symbols[i];
               symbolSelect.appendChild(option);
           }
            changeSymbol();
        });
    }
    function clock()
    {

        getPrice();
        getPriceList();
    }
    function changeSymbol(){
        symbol = document.getElementById("symbol").value;
        console.log(symbol);
        getPrice();
        getPriceList();
    }

    $(document).ready(function(){

        document.getElementById('create').onclick = function () {
            pricelist.push(parseFloat(document.getElementById('input').value) );
            pushPriceList();

        };
        document.getElementById('createSymbol').onclick = function () {

            createSymbol(document.getElementById("createSymbolInput").value);

        };
        document.getElementById('deleteSymbol').onclick = function () {

            deleteSymbol(document.getElementById("createSymbolInput").value);

        };

        getEnableSymbols();

        self.setInterval("clock()",2000);

    });

</script>
<div>
    <label >create Symbol:</label>
    <input type="input" id="createSymbolInput"/>
    <button id="createSymbol">Create</button>
    <button id="deleteSymbol">Delete</button>
</div>

<div>
    <select id="symbol" onchange="changeSymbol()">
        <!--<option value="ETHUSDT">ETHUSDT</option>-->
        <!--<option value="ZRXUSDT">ZRXUSDT</option>-->
    </select>
</div>


<div>
    <label id="nowPrice">Now Price:</label>
</div>


<label >price:</label>
<input type="input" id="input"/>
<button id="create">Create</button>

<table id="priceTable" border="0">

</table>

</body>
</html>